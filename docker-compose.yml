version: "3.8"

services:
  # --- INFRAESTRUTURA (Broker + Simulador + GestÃ£o da Mina) ---
  infra_mina:
    build: .
    container_name: infra_mina
    environment:
      - START_SIMULATOR=1
      - START_CAMINHAO=0
      - START_UI=0
      - BROKER_HOST=localhost
      - DISPLAY=${DISPLAY}        # passa DISPLAY do host para o container
      - XDG_RUNTIME_DIR=/tmp/runtime # <-- ADICIONEI ESTA LINHA
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw  # compartilha o socket do X
    ports:
      - "1883:1883"
    networks:
      - net_mina

  # --- FROTA DE CAMINHÃ•ES (Processos C++) ---

  caminhao_01:
    build: .
    container_name: caminhao_01
    depends_on:
      - infra_mina
    environment:
      - CAMINHAO_ID=1
      - START_SIMULATOR=0
      - START_CAMINHAO=1
      - START_UI=0
      - BROKER_HOST=infra_mina
    networks:
      - net_mina

  caminhao_02:
    build: .
    container_name: caminhao_02
    depends_on:
      - infra_mina
    environment:
      - CAMINHAO_ID=2
      - START_SIMULATOR=0
      - START_CAMINHAO=1
      - START_UI=0
      - BROKER_HOST=infra_mina
    networks:
      - net_mina

  caminhao_03:
    build: .
    container_name: caminhao_03
    depends_on:
      - infra_mina
    environment:
      - CAMINHAO_ID=3
      - START_SIMULATOR=0
      - START_CAMINHAO=1
      - START_UI=0
      - BROKER_HOST=infra_mina
    networks:
      - net_mina

  caminhao_04:
    build: .
    container_name: caminhao_04
    depends_on:
      - infra_mina
    environment:
      - CAMINHAO_ID=4
      - START_SIMULATOR=0
      - START_CAMINHAO=1
      - START_UI=0
      - BROKER_HOST=infra_mina
    networks:
      - net_mina

  caminhao_05:
    build: .
    container_name: caminhao_05
    depends_on:
      - infra_mina
    environment:
      - CAMINHAO_ID=5
      - START_SIMULATOR=0
      - START_CAMINHAO=1
      - START_UI=0
      - BROKER_HOST=infra_mina
    networks:
      - net_mina

networks:
  net_mina:
    driver: bridge